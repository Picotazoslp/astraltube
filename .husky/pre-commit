#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” Running pre-commit checks..."

# Run lint-staged for staged files
npx lint-staged

# Security audit check
echo "ğŸ”’ Running security audit..."
npm audit --audit-level=moderate || {
  echo "âŒ Security vulnerabilities found! Please fix them before committing."
  exit 1
}

# Type checking (if TypeScript is present)
if [ -f "tsconfig.json" ]; then
  echo "ğŸ” Type checking..."
  npx tsc --noEmit || {
    echo "âŒ Type errors found! Please fix them before committing."
    exit 1
  }
fi

# Test build to ensure no build errors
echo "ğŸ”¨ Testing build..."
npm run build > /dev/null 2>&1 || {
  echo "âŒ Build failed! Please fix build errors before committing."
  exit 1
}

echo "âœ… Pre-commit checks passed!"